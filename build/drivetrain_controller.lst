ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"drivetrain_controller.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.drivetrain_move,"ax",%progbits
  20              		.align	1
  21              		.global	drivetrain_move
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	drivetrain_move:
  27              	.LFB138:
  28              		.file 1 "Src/drivetrain_controller.c"
   1:Src/drivetrain_controller.c **** //
   2:Src/drivetrain_controller.c **** // Created by hunter on 11/15/19.
   3:Src/drivetrain_controller.c **** //
   4:Src/drivetrain_controller.c **** 
   5:Src/drivetrain_controller.c **** #include "drivetrain_controller.h"
   6:Src/drivetrain_controller.c **** #include <FreeRTOS.h>
   7:Src/drivetrain_controller.c **** #include <can_manager.h>
   8:Src/drivetrain_controller.c **** #include <math.h>
   9:Src/drivetrain_controller.c **** #include <print.h>
  10:Src/drivetrain_controller.c **** #include <rt_conf.h>
  11:Src/drivetrain_controller.c **** #include <stdio.h>
  12:Src/drivetrain_controller.c **** #include <stm32f3xx_hal.h>
  13:Src/drivetrain_controller.c **** #include <string.h>
  14:Src/drivetrain_controller.c **** #include <task.h>
  15:Src/drivetrain_controller.c **** #include "VESC.h"
  16:Src/drivetrain_controller.c **** #include "stdlib.h"
  17:Src/drivetrain_controller.c **** 
  18:Src/drivetrain_controller.c **** // I am telling the motor controllers to implement a twist message until I get
  19:Src/drivetrain_controller.c **** // another twist message
  20:Src/drivetrain_controller.c **** F32 new_speed_left = 0;
  21:Src/drivetrain_controller.c **** F32 new_speed_right = 0;
  22:Src/drivetrain_controller.c **** 
  23:Src/drivetrain_controller.c **** void drivetrain_move(rmc_can_msg msg) {
  29              		.loc 1 23 39 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 24
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33 0000 00B5     		push	{lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 4
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 2


  36              		.cfi_offset 14, -4
  37 0002 2DED028B 		vpush.64	{d8}
  38              	.LCFI1:
  39              		.cfi_def_cfa_offset 12
  40              		.cfi_offset 80, -12
  41              		.cfi_offset 81, -8
  42 0006 87B0     		sub	sp, sp, #28
  43              	.LCFI2:
  44              		.cfi_def_cfa_offset 40
  45 0008 EC46     		mov	ip, sp
  46 000a 8CE80F00 		stm	ip, {r0, r1, r2, r3}
  24:Src/drivetrain_controller.c ****   // Because of the mask we only get messages that have our ID
  25:Src/drivetrain_controller.c ****   S32 cmd_speed = 0;  // in mm/s
  47              		.loc 1 25 3 view .LVU1
  48              	.LVL0:
  26:Src/drivetrain_controller.c ****   S32 cmd_angV = 0;
  49              		.loc 1 26 3 view .LVU2
  27:Src/drivetrain_controller.c **** 
  28:Src/drivetrain_controller.c ****   //    if(msg.id & 0xFF != DRIVETRAIN_SYS_ID)
  29:Src/drivetrain_controller.c ****   //    {
  30:Src/drivetrain_controller.c ****   //        return;
  31:Src/drivetrain_controller.c ****   //    }
  32:Src/drivetrain_controller.c ****   // This portion is already done by the CAN dispatcher. It is here purely for
  33:Src/drivetrain_controller.c ****   // Hunter's understanding.
  34:Src/drivetrain_controller.c **** 
  35:Src/drivetrain_controller.c ****   S32 idx = 0;
  50              		.loc 1 35 3 view .LVU3
  51              		.loc 1 35 7 is_stmt 0 view .LVU4
  52 000e 0023     		movs	r3, #0
  53 0010 0593     		str	r3, [sp, #20]
  36:Src/drivetrain_controller.c ****   switch (msg.id >> 8) {
  54              		.loc 1 36 3 is_stmt 1 view .LVU5
  55              		.loc 1 36 18 is_stmt 0 view .LVU6
  56 0012 030A     		lsrs	r3, r0, #8
  57              		.loc 1 36 3 view .LVU7
  58 0014 232B     		cmp	r3, #35
  59 0016 04D0     		beq	.L4
  60              	.LVL1:
  61              	.L1:
  37:Src/drivetrain_controller.c ****     case DRIVE_MSG_TWIST:
  38:Src/drivetrain_controller.c **** 
  39:Src/drivetrain_controller.c ****       cmd_angV = buffer_pop_int32(msg.buf, &idx);
  40:Src/drivetrain_controller.c ****       cmd_speed = buffer_pop_int32(msg.buf, &idx);
  41:Src/drivetrain_controller.c **** 
  42:Src/drivetrain_controller.c ****       new_speed_right = (cmd_angV * DT_WIDTH) / 2 + cmd_speed;
  43:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
  44:Src/drivetrain_controller.c ****       new_speed_right = new_speed_right * DT_MMS_TO_RPM;
  45:Src/drivetrain_controller.c ****       new_speed_left = new_speed_left * DT_MMS_TO_RPM;
  46:Src/drivetrain_controller.c ****       break;
  47:Src/drivetrain_controller.c **** 
  48:Src/drivetrain_controller.c ****     default:
  49:Src/drivetrain_controller.c ****       // weewoo something went wrong
  50:Src/drivetrain_controller.c ****       break;
  51:Src/drivetrain_controller.c ****   }
  52:Src/drivetrain_controller.c **** }
  62              		.loc 1 52 1 view .LVU8
  63 0018 07B0     		add	sp, sp, #28
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 3


  64              	.LCFI3:
  65              		.cfi_remember_state
  66              		.cfi_def_cfa_offset 12
  67              		@ sp needed
  68 001a BDEC028B 		vldm	sp!, {d8}
  69              	.LCFI4:
  70              		.cfi_restore 80
  71              		.cfi_restore 81
  72              		.cfi_def_cfa_offset 4
  73 001e 5DF804FB 		ldr	pc, [sp], #4
  74              	.LVL2:
  75              	.L4:
  76              	.LCFI5:
  77              		.cfi_restore_state
  39:Src/drivetrain_controller.c ****       cmd_speed = buffer_pop_int32(msg.buf, &idx);
  78              		.loc 1 39 7 is_stmt 1 view .LVU9
  39:Src/drivetrain_controller.c ****       cmd_speed = buffer_pop_int32(msg.buf, &idx);
  79              		.loc 1 39 18 is_stmt 0 view .LVU10
  80 0022 05A9     		add	r1, sp, #20
  81 0024 01A8     		add	r0, sp, #4
  82 0026 FFF7FEFF 		bl	buffer_pop_int32
  83              	.LVL3:
  84 002a 08EE100A 		vmov	s16, r0	@ int
  85              	.LVL4:
  40:Src/drivetrain_controller.c **** 
  86              		.loc 1 40 7 is_stmt 1 view .LVU11
  40:Src/drivetrain_controller.c **** 
  87              		.loc 1 40 19 is_stmt 0 view .LVU12
  88 002e 05A9     		add	r1, sp, #20
  89 0030 01A8     		add	r0, sp, #4
  90              	.LVL5:
  40:Src/drivetrain_controller.c **** 
  91              		.loc 1 40 19 view .LVU13
  92 0032 FFF7FEFF 		bl	buffer_pop_int32
  93              	.LVL6:
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
  94              		.loc 1 42 7 is_stmt 1 view .LVU14
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
  95              		.loc 1 42 35 is_stmt 0 view .LVU15
  96 0036 B8EEC88A 		vcvt.f32.s32	s16, s16
  97              	.LVL7:
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
  98              		.loc 1 42 35 view .LVU16
  99 003a DFED137A 		vldr.32	s15, .L5
 100 003e 28EE278A 		vmul.f32	s16, s16, s15
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
 101              		.loc 1 42 47 view .LVU17
 102 0042 F6EE007A 		vmov.f32	s15, #5.0e-1
 103 0046 28EE278A 		vmul.f32	s16, s16, s15
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
 104              		.loc 1 42 51 view .LVU18
 105 004a 07EE900A 		vmov	s15, r0	@ int
 106 004e F8EEE77A 		vcvt.f32.s32	s15, s15
 107 0052 37EE888A 		vadd.f32	s16, s15, s16
  42:Src/drivetrain_controller.c ****       new_speed_left = cmd_speed * 2 - new_speed_right;
 108              		.loc 1 42 23 view .LVU19
 109 0056 0D4A     		ldr	r2, .L5+4
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 4


 110 0058 82ED008A 		vstr.32	s16, [r2]
  43:Src/drivetrain_controller.c ****       new_speed_right = new_speed_right * DT_MMS_TO_RPM;
 111              		.loc 1 43 7 is_stmt 1 view .LVU20
  43:Src/drivetrain_controller.c ****       new_speed_right = new_speed_right * DT_MMS_TO_RPM;
 112              		.loc 1 43 34 is_stmt 0 view .LVU21
 113 005c 4300     		lsls	r3, r0, #1
 114 005e 07EE903A 		vmov	s15, r3	@ int
  43:Src/drivetrain_controller.c ****       new_speed_right = new_speed_right * DT_MMS_TO_RPM;
 115              		.loc 1 43 38 view .LVU22
 116 0062 F8EEE77A 		vcvt.f32.s32	s15, s15
 117 0066 77EEC87A 		vsub.f32	s15, s15, s16
  43:Src/drivetrain_controller.c ****       new_speed_right = new_speed_right * DT_MMS_TO_RPM;
 118              		.loc 1 43 22 view .LVU23
 119 006a 094B     		ldr	r3, .L5+8
 120 006c C3ED007A 		vstr.32	s15, [r3]
  44:Src/drivetrain_controller.c ****       new_speed_left = new_speed_left * DT_MMS_TO_RPM;
 121              		.loc 1 44 7 is_stmt 1 view .LVU24
  44:Src/drivetrain_controller.c ****       new_speed_left = new_speed_left * DT_MMS_TO_RPM;
 122              		.loc 1 44 41 is_stmt 0 view .LVU25
 123 0070 9FED087A 		vldr.32	s14, .L5+12
 124 0074 28EE078A 		vmul.f32	s16, s16, s14
  44:Src/drivetrain_controller.c ****       new_speed_left = new_speed_left * DT_MMS_TO_RPM;
 125              		.loc 1 44 23 view .LVU26
 126 0078 82ED008A 		vstr.32	s16, [r2]
  45:Src/drivetrain_controller.c ****       break;
 127              		.loc 1 45 7 is_stmt 1 view .LVU27
  45:Src/drivetrain_controller.c ****       break;
 128              		.loc 1 45 39 is_stmt 0 view .LVU28
 129 007c 67EE877A 		vmul.f32	s15, s15, s14
  45:Src/drivetrain_controller.c ****       break;
 130              		.loc 1 45 22 view .LVU29
 131 0080 C3ED007A 		vstr.32	s15, [r3]
  46:Src/drivetrain_controller.c **** 
 132              		.loc 1 46 7 is_stmt 1 view .LVU30
 133              		.loc 1 52 1 is_stmt 0 view .LVU31
 134 0084 C8E7     		b	.L1
 135              	.L6:
 136 0086 00BF     		.align	2
 137              	.L5:
 138 0088 00007A44 		.word	1148846080
 139 008c 00000000 		.word	.LANCHOR0
 140 0090 00000000 		.word	.LANCHOR1
 141 0094 7DD68740 		.word	1082644093
 142              		.cfi_endproc
 143              	.LFE138:
 145              		.section	.text.drivetrain_loop,"ax",%progbits
 146              		.align	1
 147              		.global	drivetrain_loop
 148              		.syntax unified
 149              		.thumb
 150              		.thumb_func
 152              	drivetrain_loop:
 153              	.LVL8:
 154              	.LFB139:
  53:Src/drivetrain_controller.c **** 
  54:Src/drivetrain_controller.c **** void drivetrain_loop(void const* argument) {
 155              		.loc 1 54 44 is_stmt 1 view -0
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 5


 156              		.cfi_startproc
 157              		@ args = 0, pretend = 0, frame = 8
 158              		@ frame_needed = 0, uses_anonymous_args = 0
 159              		.loc 1 54 44 is_stmt 0 view .LVU33
 160 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 161              	.LCFI6:
 162              		.cfi_def_cfa_offset 24
 163              		.cfi_offset 4, -24
 164              		.cfi_offset 5, -20
 165              		.cfi_offset 6, -16
 166              		.cfi_offset 7, -12
 167              		.cfi_offset 8, -8
 168              		.cfi_offset 14, -4
 169 0004 82B0     		sub	sp, sp, #8
 170              	.LCFI7:
 171              		.cfi_def_cfa_offset 32
  55:Src/drivetrain_controller.c ****   // SETUP
  56:Src/drivetrain_controller.c ****   registerCANMsgHandler(DRIVETRAIN_SYS_ID, &drivetrain_move);
 172              		.loc 1 56 3 is_stmt 1 view .LVU34
 173 0006 1949     		ldr	r1, .L10
 174 0008 6420     		movs	r0, #100
 175              	.LVL9:
 176              		.loc 1 56 3 is_stmt 0 view .LVU35
 177 000a FFF7FEFF 		bl	registerCANMsgHandler
 178              	.LVL10:
  57:Src/drivetrain_controller.c ****   VESC* blm = create_vesc(DRIVE_MOTOR_BL, DRIVE_MOTOR_POLE_PAIRS);
 179              		.loc 1 57 3 is_stmt 1 view .LVU36
 180              		.loc 1 57 15 is_stmt 0 view .LVU37
 181 000e 0721     		movs	r1, #7
 182 0010 0220     		movs	r0, #2
 183 0012 FFF7FEFF 		bl	create_vesc
 184              	.LVL11:
 185 0016 8046     		mov	r8, r0
 186              	.LVL12:
  58:Src/drivetrain_controller.c ****   VESC* brm = create_vesc(DRIVE_MOTOR_BR, DRIVE_MOTOR_POLE_PAIRS);
 187              		.loc 1 58 3 is_stmt 1 view .LVU38
 188              		.loc 1 58 15 is_stmt 0 view .LVU39
 189 0018 0721     		movs	r1, #7
 190 001a 0420     		movs	r0, #4
 191              	.LVL13:
 192              		.loc 1 58 15 view .LVU40
 193 001c FFF7FEFF 		bl	create_vesc
 194              	.LVL14:
 195 0020 0746     		mov	r7, r0
 196              	.LVL15:
  59:Src/drivetrain_controller.c ****   VESC* frm = create_vesc(DRIVE_MOTOR_FR, DRIVE_MOTOR_POLE_PAIRS);
 197              		.loc 1 59 3 is_stmt 1 view .LVU41
 198              		.loc 1 59 15 is_stmt 0 view .LVU42
 199 0022 0721     		movs	r1, #7
 200 0024 0320     		movs	r0, #3
 201              	.LVL16:
 202              		.loc 1 59 15 view .LVU43
 203 0026 FFF7FEFF 		bl	create_vesc
 204              	.LVL17:
 205 002a 0646     		mov	r6, r0
 206              	.LVL18:
  60:Src/drivetrain_controller.c ****   VESC* flm = create_vesc(DRIVE_MOTOR_FL, DRIVE_MOTOR_POLE_PAIRS);
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 6


 207              		.loc 1 60 3 is_stmt 1 view .LVU44
 208              		.loc 1 60 15 is_stmt 0 view .LVU45
 209 002c 0721     		movs	r1, #7
 210 002e 0120     		movs	r0, #1
 211              	.LVL19:
 212              		.loc 1 60 15 view .LVU46
 213 0030 FFF7FEFF 		bl	create_vesc
 214              	.LVL20:
 215 0034 0546     		mov	r5, r0
 216              	.LVL21:
 217              	.L8:
  61:Src/drivetrain_controller.c **** 
  62:Src/drivetrain_controller.c ****   TickType_t lastWakeTime;
 218              		.loc 1 62 3 is_stmt 1 discriminator 1 view .LVU47
  63:Src/drivetrain_controller.c ****   // END SETUP
  64:Src/drivetrain_controller.c **** 
  65:Src/drivetrain_controller.c ****   while (1) {
 219              		.loc 1 65 3 discriminator 1 view .LVU48
  66:Src/drivetrain_controller.c ****     vTaskDelayUntil(
 220              		.loc 1 66 5 discriminator 1 view .LVU49
 221 0036 6421     		movs	r1, #100
 222 0038 01A8     		add	r0, sp, #4
 223 003a FFF7FEFF 		bl	vTaskDelayUntil
 224              	.LVL22:
  67:Src/drivetrain_controller.c ****         &lastWakeTime,
  68:Src/drivetrain_controller.c ****         DRIVE_LOOP_MS * portTICK_RATE_MS);  // Not sure what this does yet,
  69:Src/drivetrain_controller.c ****     // min 1hz refresh rate
  70:Src/drivetrain_controller.c **** 
  71:Src/drivetrain_controller.c ****     vesc_set_rpm(blm, new_speed_left);
 225              		.loc 1 71 5 discriminator 1 view .LVU50
 226 003e 0C4C     		ldr	r4, .L10+4
 227 0040 94ED000A 		vldr.32	s0, [r4]
 228 0044 4046     		mov	r0, r8
 229 0046 FFF7FEFF 		bl	vesc_set_rpm
 230              	.LVL23:
  72:Src/drivetrain_controller.c ****     vesc_set_rpm(flm, new_speed_left);
 231              		.loc 1 72 5 discriminator 1 view .LVU51
 232 004a 94ED000A 		vldr.32	s0, [r4]
 233 004e 2846     		mov	r0, r5
 234 0050 FFF7FEFF 		bl	vesc_set_rpm
 235              	.LVL24:
  73:Src/drivetrain_controller.c ****     vesc_set_rpm(brm, new_speed_right);
 236              		.loc 1 73 5 discriminator 1 view .LVU52
 237 0054 074C     		ldr	r4, .L10+8
 238 0056 94ED000A 		vldr.32	s0, [r4]
 239 005a 3846     		mov	r0, r7
 240 005c FFF7FEFF 		bl	vesc_set_rpm
 241              	.LVL25:
  74:Src/drivetrain_controller.c ****     vesc_set_rpm(frm, new_speed_right);
 242              		.loc 1 74 5 discriminator 1 view .LVU53
 243 0060 94ED000A 		vldr.32	s0, [r4]
 244 0064 3046     		mov	r0, r6
 245 0066 FFF7FEFF 		bl	vesc_set_rpm
 246              	.LVL26:
  65:Src/drivetrain_controller.c ****     vTaskDelayUntil(
 247              		.loc 1 65 9 discriminator 1 view .LVU54
 248 006a E4E7     		b	.L8
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 7


 249              	.L11:
 250              		.align	2
 251              	.L10:
 252 006c 00000000 		.word	drivetrain_move
 253 0070 00000000 		.word	.LANCHOR1
 254 0074 00000000 		.word	.LANCHOR0
 255              		.cfi_endproc
 256              	.LFE139:
 258              		.global	new_speed_right
 259              		.global	new_speed_left
 260              		.section	.bss.new_speed_left,"aw",%nobits
 261              		.align	2
 262              		.set	.LANCHOR1,. + 0
 265              	new_speed_left:
 266 0000 00000000 		.space	4
 267              		.section	.bss.new_speed_right,"aw",%nobits
 268              		.align	2
 269              		.set	.LANCHOR0,. + 0
 272              	new_speed_right:
 273 0000 00000000 		.space	4
 274              		.text
 275              	.Letext0:
 276              		.file 2 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 277              		.file 3 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 278              		.file 4 "Inc/types.h"
 279              		.file 5 "Inc/can_manager.h"
 280              		.file 6 "Middlewares/Third_Party/FreeRTOS/Source/portable/GCC/ARM_CM4F/portmacro.h"
 281              		.file 7 "Inc/VESC.h"
 282              		.file 8 "Middlewares/Third_Party/FreeRTOS/Source/include/task.h"
 283              		.file 9 "Inc/buffer.h"
 284              		.file 10 "Inc/drivetrain_controller.h"
ARM GAS  C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 drivetrain_controller.c
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:20     .text.drivetrain_move:00000000 $t
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:26     .text.drivetrain_move:00000000 drivetrain_move
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:138    .text.drivetrain_move:00000088 $d
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:146    .text.drivetrain_loop:00000000 $t
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:152    .text.drivetrain_loop:00000000 drivetrain_loop
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:252    .text.drivetrain_loop:0000006c $d
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:272    .bss.new_speed_right:00000000 new_speed_right
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:265    .bss.new_speed_left:00000000 new_speed_left
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:261    .bss.new_speed_left:00000000 $d
C:\Users\jmbli\AppData\Local\Temp\ccMGPVfk.s:268    .bss.new_speed_right:00000000 $d

UNDEFINED SYMBOLS
buffer_pop_int32
registerCANMsgHandler
create_vesc
vTaskDelayUntil
vesc_set_rpm
